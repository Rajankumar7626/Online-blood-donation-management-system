{% extends "base.html" %}
{% block content %}

<div class="page-header mb-4">
  <h1><i class="bi bi-bell-fill"></i> Matching Blood Requests</h1>
</div>

<div class="container">

  <!-- ðŸ”” Messages -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  {% if matches %}
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-dark">
          <tr>
            <th>Blood Group</th>
            <th>Units</th>
            <th>Requester</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for m in matches %}
          <tr>
            <!-- âœ… FIXED -->
            <td>{{ m.request.blood_group }}</td>

            <td>{{ m.request.units_required }}</td>

            <td>
              {% if m.request.hospital %}
                {{ m.request.hospital.hospital_name }}
              {% else %}
                {{ m.request.requested_by.username }}
              {% endif %}
            </td>

            <td>
              <a href="{% url 'donors:respond-request' m.id 'accept' %}"
                 class="btn btn-sm btn-success"
                 onclick="return confirm('Accept this blood request?');">
                Accept
              </a>

              <a href="{% url 'donors:respond-request' m.id 'reject' %}"
                 class="btn btn-sm btn-danger"
                 onclick="return confirm('Reject this blood request?');">
                Reject
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">
      No matching requests at the moment.
    </div>
  {% endif %}

</div>

{% endblock %}
