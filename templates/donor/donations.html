{% extends "base.html" %}

{% block content %}

<div class="page-header mb-4">
  <h1><i class="bi bi-clock-history"></i> Donation History</h1>
  <p class="text-muted">Your blood donation records</p>
</div>

<div class="container mb-5">

  <!-- ===== Stats ===== -->
  <div class="row text-center mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6>Total Donations</h6>
          <h3>{{ total }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6>Completed</h6>
          <h3 class="text-success">{{ completed }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6>Pending</h6>
          <h3 class="text-warning">{{ pending }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Table ===== -->
  <div class="card shadow-sm">
    <div class="card-body">

      {% if donations %}
        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead class="table-dark">
              <tr>
                <th>Date</th>
                <th>Blood Group</th>
                <th>Units</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>

              {% for d in donations %}
              <tr>
                <td>{{ d.created_at|date:"d M Y" }}</td>
                <td>{{ d.request.blood_group }}</td>
                <td>{{ d.units_donated }}</td>
                <td>
                  <span class="badge
                    {% if d.status == 'completed' %}
                      bg-success
                    {% elif d.status == 'rejected' %}
                      bg-danger
                    {% else %}
                      bg-warning text-dark
                    {% endif %}">
                    {{ d.status|title }}
                  </span>
                </td>
                <td>
                  <a href="{% url 'donors:donation-detail' d.id %}"
                     class="btn btn-sm btn-outline-primary">
                    View
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center">
                  No donations yet.
                </td>
              </tr>
              {% endfor %}
              
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-info">
          You have not donated blood yet.
        </div>
      {% endif %}

      <div class="mt-3">
        <a href="{% url 'donors:donor-dashboard' %}"
           class="btn btn-outline-secondary btn-sm">
          Back to Dashboard
        </a>
      </div>

    </div>
  </div>

</div>

{% endblock %}
